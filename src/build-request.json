{
  "kind": "build_request",
  "title": "Fix non-working “Save & Lock In” button in Auto Planner",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Implement a backend canister method `createGoalWithCustomDuration(description, timeFrame, motivation, durationDays)` that creates a goal with `durationDays` persisted (non-zero) and returns the new goal id, so the Auto Planner flow can save plans that specify a custom duration.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-3"
        ],
        "quotes": [
          "the save and lock in button isnt working"
        ]
      },
      "acceptanceCriteria": [
        "`backend/main.mo` exposes `createGoalWithCustomDuration` as a shared method and enforces the same authorization checks as `createGoal`.",
        "The new goal’s `durationDays` equals the provided `durationDays` argument (Nat) when retrieved via `getGoal`.",
        "No state migration is required and existing goals are unaffected."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Fix the Auto Planner “Save & Lock In” flow to reliably create the goal, add milestones/weekly tasks/daily tasks, and lock in the goal, with clear user feedback when any step fails.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-3"
        ],
        "quotes": [
          "the save and lock in button isnt working"
        ]
      },
      "acceptanceCriteria": [
        "Clicking “Save & Lock In” in `frontend/src/components/AutoPlanner/AutoPlannerReview.tsx` performs the full save sequence without throwing a missing-method/actor error.",
        "When the save succeeds, a success toast is shown and `onSaveComplete()` is called, and the created goal appears in the goals list as locked in.",
        "When any step fails (create goal, add milestones/tasks, lock in), the UI shows an error toast with a readable message and the button returns to an enabled non-loading state (i.e., `isSaving` is reset).",
        "The button remains disabled while a save is in progress to prevent double-submission."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single-actor Motoko canister (all logic in `backend/main.mo`).",
    "Do not edit any files under `frontend/src/components/ui` or other immutable frontend paths listed in SYSTEM_CONTEXT."
  ],
  "nonGoals": [
    "Redesigning the Auto Planner UI or changing the planning workflow steps beyond making the save/lock-in action work reliably.",
    "Adding third-party services, external databases, or non-Internet-Identity authentication."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}